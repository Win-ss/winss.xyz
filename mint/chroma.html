<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chroma | Color Playground</title>
    <link rel="icon" type="image/png" href="../assets/favicon.png">
    <meta name="description" content="Color Intelligence Tool">
    
    <style>
        /* --- FONTS --- */
        @font-face {
            font-family: 'Monocraft';
            src: url('../assets/Monocraft.woff2') format('woff2'),
                 url('../assets/Monocraft.woff') format('woff'),
                 url('../assets/Monocraft.ttc') format('truetype-collection');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* --- VARIABLES --- */
        :root {
            --bg-deep: #050505;
            --bg-surface: #0f0f11;
            --bg-surface-hover: #18181b;
            --border: #27272a;
            --border-hover: #3f3f46;
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
            --accent: #4f46e5;
            --accent-glow: rgba(79, 70, 229, 0.3);
            
            --font-mono: 'Monocraft', monospace;
            
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-mono);
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        a { text-decoration: none; color: inherit; }
        button, input { font-family: inherit; border: none; outline: none; background: none; color: inherit; }

        /* --- LAYOUT --- */
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            min-height: 100vh;
        }

        @media (max-width: 1024px) {
            .app-container { grid-template-columns: 1fr; }
        }

        /* --- SIDEBAR --- */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: -0.05em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .brand span { color: var(--accent); }

        .control-panel {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            justify-content: space-between;
        }

        .value-input {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s var(--ease-out);
            width: 100%;
        }

        .value-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-glow);
        }

        /* --- CUSTOM PICKER --- */
        .custom-picker-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .picker-area {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            cursor: crosshair;
            background-color: red; /* Default hue base */
        }

        .picker-white {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to right, #fff, rgba(255,255,255,0));
        }

        .picker-black {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to top, #000, rgba(0,0,0,0));
        }

        .picker-cursor {
            width: 12px; height: 12px;
            border: 2px solid white;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        .hue-slider {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
            position: relative;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .hue-thumb {
            width: 18px; height: 18px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid rgba(0,0,0,0.6);
            box-shadow: 0 6px 14px rgba(0,0,0,0.55), 0 0 0 4px rgba(79,70,229,0.06);
            pointer-events: none;
        }

        .saved-colors-panel {
            margin-top: 1rem;
        }

        .saved-colors-panel .label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
        }

        .saved-scroller {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        .saved-scroller .swipe-btn {
            margin-bottom: 1.2rem;
            position: relative;
            z-index: 60;
        }

        .saved-swatches {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 10rem 2rem 0.5rem 2rem;
            margin: -4rem -1rem 0 -1rem;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) transparent;
            flex: 1 1 auto;
            scroll-snap-type: x mandatory;
        }

        .saved-swatches::-webkit-scrollbar {
            height: 8px;
        }
        .saved-swatches::-webkit-scrollbar-track {
            background: transparent;
        }
        .saved-swatches::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, rgba(79,70,229,0.9), rgba(147,51,234,0.9));
            border-radius: 999px;
            box-shadow: 0 0 10px rgba(79,70,229,0.2);
        }

        .saved-swatch {
            flex: 0 0 92px;
            height: 48px;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.04);
            transition: transform 0.15s var(--ease-out), box-shadow 0.15s;
            scroll-snap-align: start;
        }
        .saved-swatch:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(0,0,0,0.6); }

        .saved-swatch span {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.15s var(--ease-out);
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .saved-swatch:hover span { 
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        .empty-state-small {
            color: var(--text-muted);
            font-size: 0.85rem;
            padding: 0.75rem;
        }

        .swipe-btn {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
            border: 1px solid rgba(255,255,255,0.04);
            color: var(--text-muted);
            cursor: pointer;
            transition: transform 0.12s, color 0.12s, box-shadow 0.12s;
            flex: 0 0 auto;
        }
        .swipe-btn:hover { transform: translateY(-2px); color: var(--accent); box-shadow: 0 6px 20px rgba(79,70,229,0.12); }
        .swipe-btn:disabled { opacity: 0.25; cursor: default; transform: none; box-shadow: none; }

        /* delete controls for saved swatches */
        .swatch-delete-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 20px;
            height: 20px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.32);
            border: 1px solid rgba(255,255,255,0.04);
            color: #fff;
            cursor: pointer;
            z-index: 3;
            padding: 0;
            transition: background 0.12s, transform 0.12s;
        }
        .swatch-delete-btn:hover { background: rgba(239,68,68,0.95); transform: translateY(-2px); }

        .delete-confirm {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-surface);
            color: var(--text-main);
            border: 1px solid var(--border);
            padding: 0.75rem;
            border-radius: 12px;
            width: 160px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            display: none;
            z-index: 50;
            text-align: center;
        }
        .saved-swatch:first-child .delete-confirm {
            left: 0;
            transform: translateX(0);
        }
        .saved-swatch:last-child .delete-confirm {
            left: auto;
            right: 0;
            transform: translateX(0);
        }
        .delete-confirm div:first-child {
            white-space: nowrap;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .delete-confirm.visible { display: block; }

        .delete-confirm .confirm-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            margin-top: 0.5rem;
        }
        .delete-confirm .confirm-yes {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .delete-confirm .confirm-no {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* --- MAIN STAGE --- */
        .main-stage {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* --- BENTO GRID --- */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s var(--ease-out);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .card-title {
            font-size: 1rem;
            font-weight: bold;
        }

        /* --- PALETTES --- */
        .palette-display {
            display: flex;
            height: 80px;
            margin-top: auto;
            position: relative;
        }

        .swatch:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        .swatch:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }

        .swatch {
            flex: 1;
            cursor: pointer;
            transition: flex 0.3s var(--ease-out);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swatch:hover { flex: 2; }

        .swatch span {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            font-size: 0.7rem;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s var(--ease-out);
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .swatch:hover span { 
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        /* --- CONTRAST --- */
        .contrast-checker {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            height: 150px;
        }

        .contrast-box {
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1rem;
            border: 1px solid var(--border);
        }

        .contrast-score {
            font-size: 2.5rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .badge.pass { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .badge.fail { background: rgba(239, 68, 68, 0.2); color: #f87171; }

        /* --- UTILS --- */
        .copy-btn {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .copy-btn:hover { opacity: 1; }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--text-main);
            color: var(--bg-deep);
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: bold;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s var(--ease-out);
            z-index: 100;
        }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* --- ANIMATED BG --- */
        .bg-glow {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }
        .glow-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            animation: float 20s infinite ease-in-out;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, -30px); }
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s var(--ease-out);
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        .modal-content {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2rem;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s var(--ease-out);
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 2rem;
            font-weight: bold;
        }
        .close-btn {
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
        }
        .shades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
        }
        .shade-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .shade-item {
            height: 60px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: transform 0.2s;
            position: relative;
        }
        .shade-item:hover {
            transform: scale(1.05);
            z-index: 1;
        }
        .shade-item span {
            position: absolute;
            bottom: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s var(--ease-out);
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .shade-item:hover span { 
            opacity: 1;
            transform: translateX(-50%) translateY(-2px);
        }

        .extractor-section {
            margin-top: 2rem;
        }

        .code-input-container {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .code-textarea {
            width: 100%;
            min-height: 200px;
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--text-main);
            resize: vertical;
            transition: all 0.2s var(--ease-out);
            line-height: 1.6;
        }

        .code-textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-glow);
            outline: none;
        }

        .code-textarea::placeholder {
            color: var(--text-muted);
            opacity: 0.6;
        }

        .extractor-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--accent);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            border: none;
            font-family: var(--font-mono);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .action-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
        }

        .action-btn.secondary:hover {
            border-color: var(--accent);
            color: var(--text-main);
            box-shadow: none;
        }

        .extracted-stats {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .stats-count {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: bold;
        }

        /* --- EXTRACTED COLORS GRID --- */
        .extracted-colors-container {
            display: none;
        }

        .extracted-colors-container.has-colors {
            display: block;
        }

        .mode-toggle-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: var(--bg-surface);
            padding: 0.5rem;
            border-radius: 12px;
            width: fit-content;
            border: 1px solid var(--border);
        }

        .mode-toggle {
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            font-size: 0.85rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .mode-toggle.active {
            background: var(--accent);
            color: white;
        }

        .mode-toggle:hover:not(.active) {
            color: var(--text-main);
        }

        .extracted-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .extracted-color-card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s var(--ease-out);
        }

        .extracted-color-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }

        .color-preview-split {
            display: flex;
            height: 120px;
        }

        .preview-half {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            cursor: pointer;
            transition: flex 0.3s var(--ease-out);
        }

        .preview-half:hover {
            flex: 1.5;
        }

        .preview-half.dark-mode {
            background: #0a0a0a;
        }

        .preview-half.light-mode {
            background: #f5f5f5;
        }

        .preview-swatch {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s var(--ease-out);
        }

        .preview-half:hover .preview-swatch {
            transform: scale(1.1);
        }

        .preview-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
            opacity: 0.6;
        }

        .preview-half.dark-mode .preview-label {
            color: white;
        }

        .preview-half.light-mode .preview-label {
            color: black;
        }

        .color-card-info {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .color-name-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .color-var-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-main);
            max-width: 70%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .color-use-btn {
            font-size: 0.7rem;
            padding: 0.35rem 0.75rem;
            background: rgba(79, 70, 229, 0.2);
            color: var(--accent);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: var(--font-mono);
        }

        .color-use-btn:hover {
            background: var(--accent);
            color: white;
        }

        .color-values {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .color-value-chip {
            font-size: 0.7rem;
            padding: 0.35rem 0.6rem;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-muted);
        }

        .color-value-chip:hover {
            background: rgba(0,0,0,0.5);
            color: var(--text-main);
        }

        .color-contrast-info {
            display: flex;
            gap: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        .contrast-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.7rem;
        }

        .contrast-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .contrast-dot.pass { background: #4ade80; }
        .contrast-dot.fail { background: #f87171; }

        /* --- PALETTE GENERATION FROM EXTRACTED --- */
        .generated-palettes-section {
            margin-top: 2rem;
            display: none;
        }

        .generated-palettes-section.visible {
            display: block;
        }

        .palette-preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .palette-preview-container {
                grid-template-columns: 1fr;
            }
        }

        .palette-preview-card {
            border-radius: 16px;
            border: 1px solid var(--border);
            position: relative;
        }

        .palette-preview-card.dark-theme {
            background: #0a0a0a;
        }

        .palette-preview-card.light-theme {
            background: #fafafa;
        }

        .palette-preview-header {
            padding: 1rem 1.25rem;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border);
        }

        .dark-theme .palette-preview-header {
            color: white;
            border-color: #222;
        }

        .light-theme .palette-preview-header {
            color: #111;
            border-color: #e0e0e0;
        }

        .palette-preview-body {
            padding: 1.5rem;
        }

        .mock-ui {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mock-button {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .mock-button:hover {
            transform: scale(1.02);
        }

        .mock-card {
            padding: 1rem;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .dark-theme .mock-card {
            background: #151515;
            border: 1px solid #222;
        }

        .light-theme .mock-card {
            background: white;
            border: 1px solid #e5e5e5;
        }

        .mock-text-primary {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .mock-text-secondary {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .mock-chips {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .mock-chip {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
        }

        .palette-swatches-row {
            display: flex;
            margin-top: 1rem;
            position: relative;
        }

        .palette-swatch-item:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        .palette-swatch-item:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }

        .palette-swatch-item {
            flex: 1;
            height: 40px;
            cursor: pointer;
            transition: flex 0.2s var(--ease-out);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .palette-swatch-item:hover {
            flex: 2;
        }

        .palette-swatch-item span {
            position: absolute;
            bottom: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.2s var(--ease-out);
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .palette-swatch-item:hover span {
            opacity: 1;
            transform: translateX(-50%) translateY(-2px);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text-main);
        }

        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1em;
            height: 1em;
            vertical-align: middle;
        }

        .icon svg {
            width: 100%;
            height: 100%;
            fill: currentColor;
        }

        .icon-accent svg {
            fill: var(--accent);
        }

        .icon-lg {
            width: 3rem;
            height: 3rem;
        }

        .btn-icon {
            margin-right: 0.5rem;
        }

    </style>
</head>
<body>

    <div class="bg-glow">
        <div class="glow-blob" style="width: 600px; height: 600px; background: var(--accent); top: -200px; left: -200px;"></div>
        <div class="glow-blob" style="width: 500px; height: 500px; background: #9333ea; bottom: -100px; right: -100px; animation-delay: -5s;"></div>
    </div>

    <div class="app-container">
        <!-- SIDEBAR CONTROLS -->
        <aside class="sidebar">
            <div class="brand">
                <a href="../index.html">←</a>
                CHROMA |<span> playground</span>
            </div>

            <div class="control-panel">
                <div class="custom-picker-container">
                    <div class="picker-area" id="pickerArea">
                        <div class="picker-white"></div>
                        <div class="picker-black"></div>
                        <div class="picker-cursor" id="pickerCursor"></div>
                    </div>
                    <div class="hue-slider" id="hueSlider">
                        <div class="hue-thumb" id="hueThumb"></div>
                    </div>
                </div>

                <div class="saved-colors-panel">
                    <div class="label">
                        <span>SAVED COLORS</span>
                        <button class="action-btn secondary" id="saveColorBtn" title="Save current color">SAVE</button>
                    </div>

                    <div class="saved-scroller" id="savedScroller">
                        <button class="swipe-btn left" id="savedPrevBtn" aria-label="Scroll left">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>

                        <div class="saved-swatches" id="savedSwatches">
                            <div class="empty-state-small">save colors so they appear here!</div>
                        </div>

                        <button class="swipe-btn right" id="savedNextBtn" aria-label="Scroll right">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6l6 6-6 6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                    </div>
                </div>

                <div class="input-group">
                    <div class="label">
                        <span>HEX</span>
                        <button class="copy-btn" onclick="copyToClipboard(document.getElementById('hexInput').value)">COPY</button>
                    </div>
                    <input type="text" class="value-input" id="hexInput" value="#4F46E5">
                </div>

                <div class="input-group">
                    <div class="label">
                        <span>RGB</span>
                        <button class="copy-btn" onclick="copyToClipboard(document.getElementById('rgbInput').value)">COPY</button>
                    </div>
                    <input type="text" class="value-input" id="rgbInput" value="79, 70, 229">
                </div>

                <div class="input-group">
                    <div class="label">
                        <span>HSL</span>
                        <button class="copy-btn" onclick="copyToClipboard(document.getElementById('hslInput').value)">COPY</button>
                    </div>
                    <input type="text" class="value-input" id="hslInput" value="243, 75%, 59%" readonly>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-stage">
            
            <!-- PALETTES SECTION -->
            <section>
                <h2 class="section-title">GENERATED COLORS</h2>
                <div class="bento-grid" id="paletteGrid">
                    <!-- Palettes injected via JS -->
                </div>
            </section>

            <!-- ANALYSIS SECTION -->
            <section>
                <h2 class="section-title">ACCESSIBILITY & ANALYSIS</h2>
                <div class="bento-grid">
                    <!-- Contrast Card -->
                    <div class="card" style="grid-column: span 2;">
                        <div class="card-header">
                            <span class="card-title">CONTRAST RATIO</span>
                            <span class="badge" id="wcagBadge">AA</span>
                        </div>
                        <div class="contrast-checker">
                            <div class="contrast-box" id="contrastWhite" style="background: var(--accent); color: white;">
                                <span>White Text</span>
                                <span class="contrast-score" id="scoreWhite">4.5</span>
                                <span class="badge" id="badgeWhite">PASS</span>
                            </div>
                            <div class="contrast-box" id="contrastBlack" style="background: var(--accent); color: black;">
                                <span>Black Text</span>
                                <span class="contrast-score" id="scoreBlack">12.1</span>
                                <span class="badge" id="badgeBlack">PASS</span>
                            </div>
                        </div>
                    </div>

                    <!-- Info Card -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">COLOR INFO</span>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 1rem; height: 100%; justify-content: center;">
                            <div class="input-group">
                                <span class="label">LUMINANCE</span>
                                <span style="font-size: 1.5rem;" id="luminanceValue">0.54</span>
                            </div>
                            <div class="input-group">
                                <span class="label">CSS VARIABLE</span>
                                <code style="background: rgba(0,0,0,0.3); padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="copyToClipboard(this.innerText)" id="cssVarOutput">--color: #4f46e5;</code>
                            </div>
                            <div class="input-group">
                                <span class="label">CMYK</span>
                                <code style="background: rgba(0,0,0,0.3); padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="copyToClipboard(this.innerText)" id="cmykOutput">c: 0, m: 0, y: 0, k: 0</code>
                            </div>
                            <div class="input-group">
                                <span class="label">LAB</span>
                                <code style="background: rgba(0,0,0,0.3); padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="copyToClipboard(this.innerText)" id="labOutput">l: 0, a: 0, b: 0</code>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="extractor-section">
                <h2 class="section-title">CODE COLOR EXTRACTOR</h2>
                
                <div class="code-input-container">
                    <textarea class="code-textarea" id="codeInput" placeholder="Paste your code here...

Examples:
• CSS:  --primary: #4F46E5;
• JSON: &quot;accent&quot;: &quot;#FF5733&quot;
• YAML: background: '#1a1a2e'
• Any format with hex (#RRGGBB), rgb(), hsl() colors

The extractor will find all colors automatically!"></textarea>
                    
                    <div class="extractor-actions">
                        <button class="action-btn" id="extractBtn">Extract Colors</button>
                        <button class="action-btn secondary" id="clearBtn">Clear</button>
                        <button class="action-btn secondary" id="sampleBtn">Load Sample</button>
                        <div class="extracted-stats" id="extractedStats">
                            <span>Colors found:</span>
                            <span class="stats-count" id="colorCount">0</span>
                        </div>
                    </div>
                </div>

                <div class="extracted-colors-container" id="extractedContainer">
                    <div class="mode-toggle-container">
                        <button class="mode-toggle active" data-mode="both">Both Modes</button>
                        <button class="mode-toggle" data-mode="dark">Dark Only</button>
                        <button class="mode-toggle" data-mode="light">Light Only</button>
                    </div>

                    <div class="extracted-grid" id="extractedGrid">
                        <!-- Extracted color cards will be inserted here -->
                    </div>
                </div>

                <div class="generated-palettes-section" id="generatedPalettes">
                    <h3 class="section-title" style="font-size: 1.5rem;">LIVE PREVIEW</h3>
                    
                    <div class="palette-preview-container" id="palettePreviewContainer">
                        <!-- Dark and Light theme previews -->
                    </div>
                </div>
            </section>

        </main>
    </div>

    <div class="toast" id="toast">Copied to clipboard!</div>

    <div class="modal-overlay" id="paletteModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Palette Name</div>
                <button class="close-btn" onclick="document.getElementById('paletteModal').classList.remove('active')">×</button>
            </div>
            <div id="modalBody">
            </div>
        </div>
    </div>

    <script>

        class ColorEngine {
            constructor() {
                this.state = {
                    r: 79, g: 70, b: 229,
                    h: 243, s: 75, l: 59,
                    hex: '#4F46E5'
                };
                
                this.dom = {
                    nativePicker: document.getElementById('nativePicker'),
                    mainPreview: document.getElementById('mainPreview'),
                    hexInput: document.getElementById('hexInput'),
                    rgbInput: document.getElementById('rgbInput'),
                    hslInput: document.getElementById('hslInput'),
                    paletteGrid: document.getElementById('paletteGrid'),
                    contrastWhite: document.getElementById('contrastWhite'),
                    contrastBlack: document.getElementById('contrastBlack'),
                    scoreWhite: document.getElementById('scoreWhite'),
                    scoreBlack: document.getElementById('scoreBlack'),
                    badgeWhite: document.getElementById('badgeWhite'),
                    badgeBlack: document.getElementById('badgeBlack'),
                    wcagBadge: document.getElementById('wcagBadge'),
                    luminanceValue: document.getElementById('luminanceValue'),
                    cssVarOutput: document.getElementById('cssVarOutput'),
                    cmykOutput: document.getElementById('cmykOutput'),
                    labOutput: document.getElementById('labOutput'),
                    toast: document.getElementById('toast'),
                    pickerArea: document.getElementById('pickerArea'),
                    pickerCursor: document.getElementById('pickerCursor'),
                    hueSlider: document.getElementById('hueSlider'),
                    hueThumb: document.getElementById('hueThumb'),
                    savedSwatches: document.getElementById('savedSwatches'),
                    savedScroller: document.getElementById('savedScroller'),
                    savedPrevBtn: document.getElementById('savedPrevBtn'),
                    savedNextBtn: document.getElementById('savedNextBtn'),
                    saveColorBtn: document.getElementById('saveColorBtn'),
                    paletteModal: document.getElementById('paletteModal'),
                    modalTitle: document.getElementById('modalTitle'),
                    modalBody: document.getElementById('modalBody')
                };

                this.init();
            }

            init() {
                this.state.hsv = this.rgbToHsv(this.state.r, this.state.g, this.state.b);
                this.bindEvents();
                this.loadSavedColors();
                this.updateUI();
            }

            bindEvents() {
                this.dom.hexInput.addEventListener('change', (e) => this.setFromHex(e.target.value));
                this.dom.hexInput.addEventListener('keyup', (e) => {
                    if(e.key === 'Enter') this.setFromHex(e.target.value);
                });
                this.dom.rgbInput.addEventListener('change', (e) => this.setFromRgbString(e.target.value));

                this.setupDrag(this.dom.pickerArea, this.handleAreaDrag.bind(this));
                this.setupDrag(this.dom.hueSlider, this.handleHueDrag.bind(this));
                if (this.dom.saveColorBtn) {
                    this.dom.saveColorBtn.addEventListener('click', () => this.saveCurrentColor());
                }

                if (this.dom.savedPrevBtn && this.dom.savedNextBtn && this.dom.savedScroller) {
                    this.dom.savedPrevBtn.addEventListener('click', (e) => { e.preventDefault(); this.scrollSaved(-1); });
                    this.dom.savedNextBtn.addEventListener('click', (e) => { e.preventDefault(); this.scrollSaved(1); });
                    this.dom.savedScroller.addEventListener('scroll', () => this.updateSavedNavVisibility());
                    window.addEventListener('resize', () => this.updateSavedNavVisibility());

                    if (this.dom.savedSwatches) {
                        this.dom.savedSwatches.setAttribute('tabindex', '0');
                        this.dom.savedSwatches.addEventListener('keydown', (e) => {
                            if (e.key === 'ArrowLeft') { e.preventDefault(); this.scrollSaved(-1); }
                            else if (e.key === 'ArrowRight') { e.preventDefault(); this.scrollSaved(1); }
                        });
                    }
                }
            }

            setupDrag(element, handler) {
                const onMove = (e) => {
                    e.preventDefault();
                    handler(e);
                };
                const onUp = () => {
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('mouseup', onUp);
                };
                element.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    handler(e);
                    document.addEventListener('mousemove', onMove);
                    document.addEventListener('mouseup', onUp);
                });
            }

            handleAreaDrag(e) {
                const rect = this.dom.pickerArea.getBoundingClientRect();
                let x = e.clientX - rect.left;
                let y = e.clientY - rect.top;
                
                x = Math.max(0, Math.min(x, rect.width));
                y = Math.max(0, Math.min(y, rect.height));

                const s = (x / rect.width) * 100;
                const v = 100 - ((y / rect.height) * 100);

                this.updateStateHSV(this.state.hsv.h, s, v);
            }

            handleHueDrag(e) {
                const rect = this.dom.hueSlider.getBoundingClientRect();
                let x = e.clientX - rect.left;
                x = Math.max(0, Math.min(x, rect.width));
                
                const h = (x / rect.width) * 360;
                this.updateStateHSV(h, this.state.hsv.s, this.state.hsv.v);
            }


            setFromHex(hex) {
                if (!hex.startsWith('#')) hex = '#' + hex;
                if (!/^#[0-9A-F]{6}$/i.test(hex)) return;

                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);

                this.updateStateRGB(r, g, b);
            }

            setFromRgbString(str) {
                const parts = str.match(/\d+/g);
                if (!parts || parts.length < 3) return;
                this.updateStateRGB(parseInt(parts[0]), parseInt(parts[1]), parseInt(parts[2]));
            }

            updateStateRGB(r, g, b) {
                r = Math.min(255, Math.max(0, r));
                g = Math.min(255, Math.max(0, g));
                b = Math.min(255, Math.max(0, b));
                
                const hsv = this.rgbToHsv(r, g, b);
                this.state.hsv = hsv;
                this.syncStateFromHSV();
            }

            updateStateHSV(h, s, v) {
                this.state.hsv = { h, s, v };
                this.syncStateFromHSV();
            }

            syncStateFromHSV() {
                const { h, s, v } = this.state.hsv;
                const rgb = this.hsvToRgb(h, s, v);
                
                this.state.r = rgb.r;
                this.state.g = rgb.g;
                this.state.b = rgb.b;
                
                this.state.hex = this.rgbToHex(rgb.r, rgb.g, rgb.b);
                
                const hsl = this.rgbToHsl(rgb.r, rgb.g, rgb.b);
                this.state.h = hsl.h;
                this.state.s = hsl.s;
                this.state.l = hsl.l;

                this.updateUI();
            }


            updateUI() {
                const { r, g, b, h, s, l, hex, hsv } = this.state;

                this.dom.hexInput.value = hex.toUpperCase();
                this.dom.rgbInput.value = `${r}, ${g}, ${b}`;
                this.dom.hslInput.value = `${h}, ${s}%, ${l}%`;

                this.dom.pickerArea.style.backgroundColor = `hsl(${hsv.h}, 100%, 50%)`;
                this.dom.pickerCursor.style.left = `${hsv.s}%`;
                this.dom.pickerCursor.style.top = `${100 - hsv.v}%`;
                this.dom.pickerCursor.style.backgroundColor = hex;
                
                this.dom.hueThumb.style.left = `${(hsv.h / 360) * 100}%`;
                this.dom.hueThumb.style.backgroundColor = `hsl(${hsv.h}, 100%, 50%)`;

                this.dom.cssVarOutput.innerText = `--color: ${hex};`;

                const cmyk = this.rgbToCmyk(r, g, b);
                this.dom.cmykOutput.innerText = `c:${cmyk.c} m:${cmyk.m} y:${cmyk.y} k:${cmyk.k}`;

                const lab = this.rgbToLab(r, g, b);
                this.dom.labOutput.innerText = `l:${lab.l} a:${lab.a} b:${lab.b}`;

                document.documentElement.style.setProperty('--accent', hex);
                document.documentElement.style.setProperty('--accent-glow', `rgba(${r}, ${g}, ${b}, 0.3)`);

                this.renderPalettes();

                this.checkContrast();
            }

            renderPalettes() {
                const { h, s, l } = this.state;
                
                const palettes = [
                    {
                        name: 'Complementary',
                        colors: [
                            { h, s, l },
                            { h: (h + 180) % 360, s, l }
                        ]
                    },
                    {
                        name: 'Analogous',
                        colors: [
                            { h: (h - 30 + 360) % 360, s, l },
                            { h, s, l },
                            { h: (h + 30) % 360, s, l }
                        ]
                    },
                    {
                        name: 'Triadic',
                        colors: [
                            { h, s, l },
                            { h: (h + 120) % 360, s, l },
                            { h: (h + 240) % 360, s, l }
                        ]
                    },
                    {
                        name: 'Monochromatic',
                        colors: [
                            { h, s, l: Math.max(0, l - 30) },
                            { h, s, l: Math.max(0, l - 15) },
                            { h, s, l },
                            { h, s, l: Math.min(100, l + 15) },
                            { h, s, l: Math.min(100, l + 30) }
                        ]
                    },
                    {
                        name: 'Split Comp.',
                        colors: [
                            { h: (h + 150) % 360, s, l },
                            { h, s, l },
                            { h: (h + 210) % 360, s, l }
                        ]
                    }
                ];

                this.dom.paletteGrid.innerHTML = '';

                palettes.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.style.cursor = 'pointer';
                    card.onclick = (e) => {
                        if(e.target.closest('.swatch')) return;
                        this.openModal(p);
                    };
                    
                    const header = document.createElement('div');
                    header.className = 'card-header';
                    header.innerHTML = `<span class="card-title">${p.name}</span><span style="font-size:0.8rem; opacity:0.5;">CLICK TO EXPAND</span>`;
                    
                    const display = document.createElement('div');
                    display.className = 'palette-display';
                    
                    p.colors.forEach(c => {
                        const rgb = this.hslToRgb(c.h/360, c.s/100, c.l/100);
                        const hex = this.rgbToHex(rgb.r, rgb.g, rgb.b);
                        
                        const swatch = document.createElement('div');
                        swatch.className = 'swatch';
                        swatch.style.backgroundColor = hex;
                        swatch.innerHTML = `<span>${hex}</span>`;
                        swatch.onclick = (e) => {
                            e.stopPropagation();
                            copyToClipboard(hex);
                        };
                        display.appendChild(swatch);
                    });

                    card.appendChild(header);
                    card.appendChild(display);
                    this.dom.paletteGrid.appendChild(card);
                });
            }

            openModal(palette) {
                this.dom.modalTitle.innerText = palette.name;
                this.dom.modalBody.innerHTML = '';

                const grid = document.createElement('div');
                grid.className = 'shades-grid';

                palette.colors.forEach(baseColor => {
                    const column = document.createElement('div');
                    column.className = 'shade-column';

                    for(let i = 0; i < 10; i++) {
                        const l = 10 + (i * 8);
                        const rgb = this.hslToRgb(baseColor.h/360, baseColor.s/100, l/100);
                        const hex = this.rgbToHex(rgb.r, rgb.g, rgb.b);
                        
                        const item = document.createElement('div');
                        item.className = 'shade-item';
                        item.style.backgroundColor = hex;
                        item.style.color = l > 50 ? 'black' : 'white';
                        item.innerHTML = `<span>${hex}</span>`;
                        item.onclick = () => copyToClipboard(hex);
                        
                        column.appendChild(item);
                    }
                    grid.appendChild(column);
                });

                this.dom.modalBody.appendChild(grid);
                this.dom.paletteModal.classList.add('active');
            }

            checkContrast() {
                const { r, g, b, hex } = this.state;
                const lum = this.getLuminance(r, g, b);
                
                this.dom.luminanceValue.innerText = lum.toFixed(3);

                // White Text (Lum 1)
                const ratioWhite = this.getContrastRatio(lum, 1);
                this.dom.contrastWhite.style.backgroundColor = hex;
                this.dom.scoreWhite.innerText = ratioWhite.toFixed(2);
                this.updateBadge(this.dom.badgeWhite, ratioWhite);

                // Black Text (Lum 0)
                const ratioBlack = this.getContrastRatio(lum, 0);
                this.dom.contrastBlack.style.backgroundColor = hex;
                this.dom.scoreBlack.innerText = ratioBlack.toFixed(2);
                this.updateBadge(this.dom.badgeBlack, ratioBlack);

                // Overall Rating
                const bestRatio = Math.max(ratioWhite, ratioBlack);
                let rating = 'FAIL';
                if (bestRatio >= 7) rating = 'AAA';
                else if (bestRatio >= 4.5) rating = 'AA';
                else if (bestRatio >= 3) rating = 'AA+';
                
                this.dom.wcagBadge.innerText = rating;
                this.dom.wcagBadge.className = `badge ${bestRatio >= 4.5 ? 'pass' : 'fail'}`;
            }

            updateBadge(el, ratio) {
                if (ratio >= 4.5) {
                    el.innerText = 'PASS';
                    el.className = 'badge pass';
                } else {
                    el.innerText = 'FAIL';
                    el.className = 'badge fail';
                }
            }

            saveCurrentColor() {
                const hex = this.state.hex.toUpperCase();
                const key = 'chroma.savedColors';
                let list = JSON.parse(localStorage.getItem(key) || '[]');
                list = list.filter(h => h !== hex);
                list.unshift(hex);
                if (list.length > 50) list = list.slice(0, 50);
                localStorage.setItem(key, JSON.stringify(list));
                this.savedColors = list;
                this.renderSavedColors();

                if (this.dom.savedScroller) {
                    this.dom.savedScroller.scrollTo({ left: 0, behavior: 'smooth' });
                    this.updateSavedNavVisibility();
                }

                this.dom.toast.classList.add('show');
                this.dom.toast.innerText = 'Color saved!';
                setTimeout(() => {
                    this.dom.toast.classList.remove('show');
                    this.dom.toast.innerText = 'Copied to clipboard!';
                }, 1500);
            }

            loadSavedColors() {
                const key = 'chroma.savedColors';
                const list = JSON.parse(localStorage.getItem(key) || '[]');
                this.savedColors = list;
                this.renderSavedColors();
            }

            renderSavedColors() {
                const container = this.dom.savedSwatches;
                const scroller = this.dom.savedScroller;
                if (!container) return;
                container.innerHTML = '';
                if (!this.savedColors || this.savedColors.length === 0) {
                    container.innerHTML = '<div class="empty-state-small">save colors so they appear here!</div>';
                    if (this.dom.savedPrevBtn) this.dom.savedPrevBtn.disabled = true;
                    if (this.dom.savedNextBtn) this.dom.savedNextBtn.disabled = true;
                    return;
                }

                this.savedColors.forEach((hex) => {
                    const sw = document.createElement('div');
                    sw.className = 'saved-swatch';
                    sw.style.backgroundColor = hex;
                    sw.title = hex;
                    sw.setAttribute('tabindex', '0');
                    sw.setAttribute('role', 'button');

                    sw.innerHTML = `
                        <span>${hex}</span>
                        <button class="swatch-delete-btn" aria-label="Delete color">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                        <div class="delete-confirm" aria-hidden="true">
                            <div style="font-size:0.85rem; opacity:0.95;">are you sure?</div>
                            <div class="confirm-actions">
                                <button class="confirm-no">No</button>
                                <button class="confirm-yes">Yes</button>
                            </div>
                        </div>
                    `;

                    sw.addEventListener('click', (e) => {
                        if (e.target.closest('.delete-confirm') || e.target.closest('.swatch-delete-btn')) return;
                        this.setFromHex(hex);
                    });

                    const deleteBtn = sw.querySelector('.swatch-delete-btn');
                    const confirm = sw.querySelector('.delete-confirm');
                    const yesBtn = sw.querySelector('.confirm-yes');
                    const noBtn = sw.querySelector('.confirm-no');

                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const open = confirm.classList.toggle('visible');
                        if (open) {
                            container.querySelectorAll('.delete-confirm.visible').forEach(c => { if (c !== confirm) c.classList.remove('visible'); });
                        }
                    });

                    noBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        confirm.classList.remove('visible');
                    });

                    yesBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.removeSavedColor(hex);
                    });

                    if (scroller) {
                        scroller.addEventListener('click', () => {
                            container.querySelectorAll('.delete-confirm.visible').forEach(c => c.classList.remove('visible'));
                        });
                    }

                    container.appendChild(sw);
                });

                setTimeout(() => this.updateSavedNavVisibility(), 50);
            }

            scrollSaved(direction = 1) {
                const scroller = this.dom.savedScroller;
                if (!scroller) return;
                const amount = Math.round(scroller.clientWidth * 0.7) * direction;
                scroller.scrollBy({ left: amount, behavior: 'smooth' });
            }

            removeSavedColor(hex) {
                const key = 'chroma.savedColors';
                let list = JSON.parse(localStorage.getItem(key) || '[]');
                list = list.filter(h => h !== hex);
                localStorage.setItem(key, JSON.stringify(list));
                this.savedColors = list;
                this.renderSavedColors();

                this.dom.toast.classList.add('show');
                this.dom.toast.innerText = 'Color removed';
                setTimeout(() => this.dom.toast.classList.remove('show'), 1400);
            }

            updateSavedNavVisibility() {
                const scroller = this.dom.savedScroller;
                if (!scroller || !this.dom.savedPrevBtn || !this.dom.savedNextBtn) return;
                const maxScroll = scroller.scrollWidth - scroller.clientWidth;
                if (maxScroll <= 0) {
                    this.dom.savedPrevBtn.disabled = true;
                    this.dom.savedNextBtn.disabled = true;
                    return;
                }
                const eps = 2;
                this.dom.savedPrevBtn.disabled = scroller.scrollLeft <= eps;
                this.dom.savedNextBtn.disabled = scroller.scrollLeft >= (maxScroll - eps);
            }

            // --- UTILS ---

            rgbToHex(r, g, b) {
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
            }

            rgbToHsv(r, g, b) {
                r /= 255; g /= 255; b /= 255;
                let v = Math.max(r, g, b), c = v - Math.min(r, g, b);
                let h = c && ((v == r) ? (g - b) / c : ((v == g) ? 2 + (b - r) / c : 4 + (r - g) / c));
                return { h: 60 * (h < 0 ? h + 6 : h), s: v && c / v * 100, v: v * 100 };
            }

            hsvToRgb(h, s, v) {
                s /= 100; v /= 100;
                let f = (n, k = (n + h / 60) % 6) => v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);
                return {
                    r: Math.round(f(5) * 255),
                    g: Math.round(f(3) * 255),
                    b: Math.round(f(1) * 255)
                };
            }

            rgbToHsl(r, g, b) {
                r /= 255; g /= 255; b /= 255;
                const max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;

                if (max === min) {
                    h = s = 0;
                } else {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                return {
                    h: Math.round(h * 360),
                    s: Math.round(s * 100),
                    l: Math.round(l * 100)
                };
            }

            hslToRgb(h, s, l) {
                let r, g, b;
                if (s === 0) {
                    r = g = b = l;
                } else {
                    const hue2rgb = (p, q, t) => {
                        if (t < 0) t += 1;
                        if (t > 1) t -= 1;
                        if (t < 1/6) return p + (q - p) * 6 * t;
                        if (t < 1/2) return q;
                        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                        return p;
                    };
                    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    const p = 2 * l - q;
                    r = hue2rgb(p, q, h + 1/3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1/3);
                }
                return {
                    r: Math.round(r * 255),
                    g: Math.round(g * 255),
                    b: Math.round(b * 255)
                };
            }

            getLuminance(r, g, b) {
                const a = [r, g, b].map(v => {
                    v /= 255;
                    return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
                });
                return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
            }

            getContrastRatio(l1, l2) {
                const lighter = Math.max(l1, l2);
                const darker = Math.min(l1, l2);
                return (lighter + 0.05) / (darker + 0.05);
            }

            rgbToCmyk(r, g, b) {
                let c = 1 - (r / 255);
                let m = 1 - (g / 255);
                let y = 1 - (b / 255);
                let k = Math.min(c, Math.min(m, y));
                
                c = (c - k) / (1 - k);
                m = (m - k) / (1 - k);
                y = (y - k) / (1 - k);
                
                if (isNaN(c)) c = 0;
                if (isNaN(m)) m = 0;
                if (isNaN(y)) y = 0;
                if (isNaN(k)) k = 0;

                return {
                    c: Math.round(c * 100),
                    m: Math.round(m * 100),
                    y: Math.round(y * 100),
                    k: Math.round(k * 100)
                };
            }

            rgbToLab(r, g, b) {
                let rLinear = r / 255;
                let gLinear = g / 255;
                let bLinear = b / 255;

                rLinear = (rLinear > 0.04045) ? Math.pow((rLinear + 0.055) / 1.055, 2.4) : rLinear / 12.92;
                gLinear = (gLinear > 0.04045) ? Math.pow((gLinear + 0.055) / 1.055, 2.4) : gLinear / 12.92;
                bLinear = (bLinear > 0.04045) ? Math.pow((bLinear + 0.055) / 1.055, 2.4) : bLinear / 12.92;

                let x = (rLinear * 0.4124 + gLinear * 0.3576 + bLinear * 0.1805) * 100;
                let y = (rLinear * 0.2126 + gLinear * 0.7152 + bLinear * 0.0722) * 100;
                let z = (rLinear * 0.0193 + gLinear * 0.1192 + bLinear * 0.9505) * 100;

                x /= 95.047;
                y /= 100.000;
                z /= 108.883;

                x = (x > 0.008856) ? Math.pow(x, 1/3) : (7.787 * x) + (16/116);
                y = (y > 0.008856) ? Math.pow(y, 1/3) : (7.787 * y) + (16/116);
                z = (z > 0.008856) ? Math.pow(z, 1/3) : (7.787 * z) + (16/116);

                return {
                    l: Math.round((116 * y) - 16),
                    a: Math.round(500 * (x - y)),
                    b: Math.round(200 * (y - z))
                };
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        class CodeColorExtractor {
            constructor(colorEngine) {
                this.colorEngine = colorEngine;
                this.extractedColors = [];
                this.displayMode = 'both';
                
                this.dom = {
                    codeInput: document.getElementById('codeInput'),
                    extractBtn: document.getElementById('extractBtn'),
                    clearBtn: document.getElementById('clearBtn'),
                    sampleBtn: document.getElementById('sampleBtn'),
                    colorCount: document.getElementById('colorCount'),
                    extractedContainer: document.getElementById('extractedContainer'),
                    extractedGrid: document.getElementById('extractedGrid'),
                    generatedPalettes: document.getElementById('generatedPalettes'),
                    palettePreviewContainer: document.getElementById('palettePreviewContainer'),
                    modeToggles: document.querySelectorAll('.mode-toggle')
                };

                this.init();
            }

            init() {
                this.dom.extractBtn.addEventListener('click', () => this.extractColors());
                this.dom.clearBtn.addEventListener('click', () => this.clearAll());
                this.dom.sampleBtn.addEventListener('click', () => this.loadSample());
                
                this.dom.modeToggles.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.dom.modeToggles.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.displayMode = e.target.dataset.mode;
                        this.renderExtractedColors();
                    });
                });

                this.dom.codeInput.addEventListener('paste', () => {
                    setTimeout(() => this.extractColors(), 100);
                });
            }

            extractColors() {
                const code = this.dom.codeInput.value;
                if (!code.trim()) return;

                const colors = this.parseColors(code);
                this.extractedColors = colors;
                
                this.dom.colorCount.textContent = colors.length;
                
                if (colors.length > 0) {
                    this.dom.extractedContainer.classList.add('has-colors');
                    this.dom.generatedPalettes.classList.add('visible');
                    this.renderExtractedColors();
                    this.renderLivePreview();
                } else {
                    this.dom.extractedContainer.classList.remove('has-colors');
                    this.dom.generatedPalettes.classList.remove('visible');
                }
            }

            parseColors(code) {
                const colors = [];
                const seen = new Set();

                const patterns = [
                    // CSS 
                    /(-{2}[\w-]+)\s*:\s*(#[0-9A-Fa-f]{3,8}|rgba?\([^)]+\)|hsla?\([^)]+\))/g,
                    // JSON/JS
                    /["']?([\w-]+)["']?\s*[:=]\s*["']?(#[0-9A-Fa-f]{3,8})["']?/g,
                    // YAML
                    /([\w-]+)\s*:\s*['"]?(#[0-9A-Fa-f]{3,8})['"]?/g,
                    // rgb/rgba values with names
                    /["']?([\w-]+)["']?\s*[:=]\s*["']?(rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(?:,\s*[\d.]+)?\s*\))["']?/gi,
                    // hsl/hsla values with names
                    /["']?([\w-]+)["']?\s*[:=]\s*["']?(hsla?\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(?:,\s*[\d.]+)?\s*\))["']?/gi,
                ];

                patterns.forEach(pattern => {
                    let match;
                    while ((match = pattern.exec(code)) !== null) {
                        const name = match[1];
                        const colorValue = match[2];
                        const parsed = this.parseColorValue(colorValue);
                        
                        if (parsed && !seen.has(parsed.hex)) {
                            seen.add(parsed.hex);
                            colors.push({
                                name: name,
                                ...parsed
                            });
                        }
                    }
                });

                const standaloneHex = /#[0-9A-Fa-f]{6}(?![0-9A-Fa-f])/g;
                let match;
                while ((match = standaloneHex.exec(code)) !== null) {
                    const hex = match[0].toUpperCase();
                    if (!seen.has(hex)) {
                        seen.add(hex);
                        const parsed = this.parseColorValue(hex);
                        if (parsed) {
                            colors.push({
                                name: `color-${colors.length + 1}`,
                                ...parsed
                            });
                        }
                    }
                }

                return colors;
            }

            parseColorValue(value) {
                let r, g, b, a = 1;

                // HEX
                if (value.startsWith('#')) {
                    let hex = value.slice(1);
                    
                    // Handle 3-char hex
                    if (hex.length === 3) {
                        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
                    }
                    // Handle 8-char hex (with alpha)
                    if (hex.length === 8) {
                        a = parseInt(hex.slice(6, 8), 16) / 255;
                        hex = hex.slice(0, 6);
                    }
                    
                    if (!/^[0-9A-Fa-f]{6}$/.test(hex)) return null;
                    
                    r = parseInt(hex.slice(0, 2), 16);
                    g = parseInt(hex.slice(2, 4), 16);
                    b = parseInt(hex.slice(4, 6), 16);
                }
                // RGB/RGBA
                else if (value.toLowerCase().startsWith('rgb')) {
                    const match = value.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+))?\s*\)/i);
                    if (!match) return null;
                    r = parseInt(match[1]);
                    g = parseInt(match[2]);
                    b = parseInt(match[3]);
                    if (match[4]) a = parseFloat(match[4]);
                }
                // HSL/HSLA
                else if (value.toLowerCase().startsWith('hsl')) {
                    const match = value.match(/hsla?\(\s*(\d+)\s*,\s*([\d.]+)%?\s*,\s*([\d.]+)%?\s*(?:,\s*([\d.]+))?\s*\)/i);
                    if (!match) return null;
                    const h = parseInt(match[1]) / 360;
                    const s = parseFloat(match[2]) / 100;
                    const l = parseFloat(match[3]) / 100;
                    if (match[4]) a = parseFloat(match[4]);
                    
                    const rgb = this.colorEngine.hslToRgb(h, s, l);
                    r = rgb.r;
                    g = rgb.g;
                    b = rgb.b;
                }
                else {
                    return null;
                }

                const hex = this.colorEngine.rgbToHex(r, g, b);
                const hsl = this.colorEngine.rgbToHsl(r, g, b);
                const luminance = this.colorEngine.getLuminance(r, g, b);

                return {
                    hex,
                    r, g, b, a,
                    h: hsl.h, s: hsl.s, l: hsl.l,
                    luminance,
                    contrastWhite: this.colorEngine.getContrastRatio(luminance, 1),
                    contrastBlack: this.colorEngine.getContrastRatio(luminance, 0)
                };
            }

            renderExtractedColors() {
                this.dom.extractedGrid.innerHTML = '';

                if (this.extractedColors.length === 0) {
                    this.dom.extractedGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-state-icon"><span class="icon icon-lg icon-accent"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.93 0 1.82-.13 2.68-.36a1 1 0 0 0 .56-1.51l-1.5-2.25a1 1 0 0 1 .84-1.53h3.17a2.25 2.25 0 0 0 2.25-2.25V12A10 10 0 0 0 12 2z"/><circle cx="7.5" cy="11.5" r="1.5" fill="var(--accent)"/><circle cx="12" cy="7.5" r="1.5" fill="var(--accent)"/><circle cx="16.5" cy="11.5" r="1.5" fill="var(--accent)"/></svg></span></div>
                            <div class="empty-state-title">No colors extracted</div>
                            <p>Paste some code with colors to get started</p>
                        </div>
                    `;
                    return;
                }

                this.extractedColors.forEach((color, index) => {
                    const card = this.createColorCard(color, index);
                    this.dom.extractedGrid.appendChild(card);
                });
            }

            createColorCard(color, index) {
                const card = document.createElement('div');
                card.className = 'extracted-color-card';

                const textColorDark = color.contrastWhite >= color.contrastBlack ? 'white' : 'black';
                const textColorLight = color.contrastBlack >= color.contrastWhite ? 'black' : 'white';

                let previewHTML = '';
                if (this.displayMode === 'both' || this.displayMode === 'dark') {
                    previewHTML += `
                        <div class="preview-half dark-mode" onclick="copyToClipboard('${color.hex}')">
                            <div class="preview-swatch" style="background: ${color.hex};"></div>
                            <span class="preview-label">Dark Mode</span>
                        </div>
                    `;
                }
                if (this.displayMode === 'both' || this.displayMode === 'light') {
                    previewHTML += `
                        <div class="preview-half light-mode" onclick="copyToClipboard('${color.hex}')">
                            <div class="preview-swatch" style="background: ${color.hex};"></div>
                            <span class="preview-label">Light Mode</span>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="color-preview-split">
                        ${previewHTML}
                    </div>
                    <div class="color-card-info">
                        <div class="color-name-row">
                            <span class="color-var-name" title="${color.name}">${color.name}</span>
                            <button class="color-use-btn" data-index="${index}">Use Color</button>
                        </div>
                        <div class="color-values">
                            <span class="color-value-chip" onclick="copyToClipboard('${color.hex}')">${color.hex}</span>
                            <span class="color-value-chip" onclick="copyToClipboard('rgb(${color.r}, ${color.g}, ${color.b})')">RGB</span>
                            <span class="color-value-chip" onclick="copyToClipboard('hsl(${color.h}, ${color.s}%, ${color.l}%)')">HSL</span>
                        </div>
                        <div class="color-contrast-info">
                            <div class="contrast-item">
                                <span class="contrast-dot ${color.contrastWhite >= 4.5 ? 'pass' : 'fail'}"></span>
                                <span>White: ${color.contrastWhite.toFixed(1)}</span>
                            </div>
                            <div class="contrast-item">
                                <span class="contrast-dot ${color.contrastBlack >= 4.5 ? 'pass' : 'fail'}"></span>
                                <span>Black: ${color.contrastBlack.toFixed(1)}</span>
                            </div>
                        </div>
                    </div>
                `;

                card.querySelector('.color-use-btn').addEventListener('click', () => {
                    this.colorEngine.updateStateRGB(color.r, color.g, color.b);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });

                return card;
            }

            renderLivePreview() {
                if (this.extractedColors.length === 0) {
                    this.dom.palettePreviewContainer.innerHTML = '';
                    return;
                }

                const primary = this.extractedColors[0];
                const secondary = this.extractedColors[1] || primary;
                const accent = this.extractedColors[2] || secondary;

                this.dom.palettePreviewContainer.innerHTML = `
                    <!-- Dark Theme Preview -->
                    <div class="palette-preview-card dark-theme">
                        <div class="palette-preview-header"><span class="icon btn-icon" style="color: ${primary.hex}"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg></span>Dark Theme Preview</div>
                        <div class="palette-preview-body">
                            <div class="mock-ui">
                                <div class="mock-button" style="background: ${primary.hex}; color: ${primary.contrastWhite >= primary.contrastBlack ? 'white' : 'black'};">
                                    Primary Action
                                </div>
                                <div class="mock-card">
                                    <span class="mock-text-primary" style="color: white;">Card Title</span>
                                    <span class="mock-text-secondary" style="color: #aaa;">Secondary text with your color palette</span>
                                    <div class="mock-chips">
                                        <span class="mock-chip" style="background: ${primary.hex}; color: ${primary.contrastWhite >= primary.contrastBlack ? 'white' : 'black'};">Tag 1</span>
                                        <span class="mock-chip" style="background: ${secondary.hex}; color: ${secondary.contrastWhite >= secondary.contrastBlack ? 'white' : 'black'};">Tag 2</span>
                                        <span class="mock-chip" style="background: ${accent.hex}; color: ${accent.contrastWhite >= accent.contrastBlack ? 'white' : 'black'};">Tag 3</span>
                                    </div>
                                </div>
                                <div class="mock-button" style="background: transparent; border: 2px solid ${secondary.hex}; color: ${secondary.hex};">
                                    Secondary Action
                                </div>
                            </div>
                            <div class="palette-swatches-row">
                                ${this.extractedColors.slice(0, 6).map(c => `
                                    <div class="palette-swatch-item" style="background: ${c.hex}; color: ${c.contrastWhite >= c.contrastBlack ? 'white' : 'black'};" onclick="copyToClipboard('${c.hex}')">
                                        <span>${c.hex}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Light Theme Preview -->
                    <div class="palette-preview-card light-theme">
                        <div class="palette-preview-header"><span class="icon btn-icon" style="color: ${primary.hex}"><svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg></span>Light Theme Preview</div>
                        <div class="palette-preview-body">
                            <div class="mock-ui">
                                <div class="mock-button" style="background: ${primary.hex}; color: ${primary.contrastWhite >= primary.contrastBlack ? 'white' : 'black'};">
                                    Primary Action
                                </div>
                                <div class="mock-card">
                                    <span class="mock-text-primary" style="color: #111;">Card Title</span>
                                    <span class="mock-text-secondary" style="color: #666;">Secondary text with your color palette</span>
                                    <div class="mock-chips">
                                        <span class="mock-chip" style="background: ${this.lightenColor(primary, 0.85)}; color: ${primary.hex};">${primary.name}</span>
                                        <span class="mock-chip" style="background: ${this.lightenColor(secondary, 0.85)}; color: ${secondary.hex};">${secondary.name}</span>
                                        <span class="mock-chip" style="background: ${this.lightenColor(accent, 0.85)}; color: ${accent.hex};">${accent.name}</span>
                                    </div>
                                </div>
                                <div class="mock-button" style="background: transparent; border: 2px solid ${secondary.hex}; color: ${secondary.hex};">
                                    Secondary Action
                                </div>
                            </div>
                            <div class="palette-swatches-row">
                                ${this.extractedColors.slice(0, 6).map(c => `
                                    <div class="palette-swatch-item" style="background: ${c.hex}; color: ${c.contrastWhite >= c.contrastBlack ? 'white' : 'black'};" onclick="copyToClipboard('${c.hex}')">
                                        <span>${c.hex}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            lightenColor(color, factor) {
                const newL = Math.min(100, color.l + (100 - color.l) * factor);
                const rgb = this.colorEngine.hslToRgb(color.h / 360, color.s / 100, newL / 100);
                return this.colorEngine.rgbToHex(rgb.r, rgb.g, rgb.b);
            }

            clearAll() {
                this.dom.codeInput.value = '';
                this.extractedColors = [];
                this.dom.colorCount.textContent = '0';
                this.dom.extractedContainer.classList.remove('has-colors');
                this.dom.generatedPalettes.classList.remove('visible');
                this.dom.extractedGrid.innerHTML = '';
                this.dom.palettePreviewContainer.innerHTML = '';
            }

            loadSample() {
                const sample = `/* Design System Colors */
:root {
    --primary: #4F46E5;
    --primary-hover: #4338CA;
    --secondary: #EC4899;
    --accent: #10B981;
    --warning: #F59E0B;
    --danger: #EF4444;
    --neutral-900: #18181B;
    --neutral-100: #F4F4F5;
}

/* Alternative formats also work! */
{
    "brand": {
        "primary": "#6366F1",
        "secondary": "#8B5CF6"
    },
    "status": {
        "success": "rgb(34, 197, 94)",
        "error": "hsl(0, 84%, 60%)"
    }
}

# YAML style
background: '#1E1E2E'
foreground: '#CDD6F4'
accent: '#89B4FA'
`;
                this.dom.codeInput.value = sample;
                this.extractColors();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const engine = new ColorEngine();
            new CodeColorExtractor(engine);
        });

    </script>
</body>
</html>